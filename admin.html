<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Admin â€” Add Tools | AI Knowledge Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .admin-form { max-width: 560px; margin: 2rem auto; padding: 0 1.25rem; }
    .admin-form h1 { margin-bottom: 0.5rem; }
    .admin-form .intro { color: var(--text-muted); margin-bottom: 1.5rem; font-size: 0.95rem; }
    .admin-form label { display: block; margin-top: 1rem; font-weight: 500; font-size: 0.9rem; }
    .admin-form input, .admin-form select, .admin-form textarea { width: 100%; padding: 0.6rem 0.9rem; margin-top: 0.35rem; font-family: inherit; font-size: 0.95rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); }
    .admin-form input:focus, .admin-form select:focus, .admin-form textarea:focus { outline: 2px solid var(--accent); outline-offset: 0; }
    .admin-form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .admin-form-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
    .admin-form-actions button { padding: 0.65rem 1.25rem; font-size: 0.95rem; font-weight: 600; border-radius: var(--radius); cursor: pointer; border: none; transition: background 0.15s; }
    .admin-form-actions button[type="submit"] { background: var(--accent); color: var(--bg); }
    .admin-form-actions button[type="submit"]:hover { background: var(--accent-hover); }
    .admin-form-actions button[type="button"] { background: var(--bg-surface); color: var(--text-muted); }
    .admin-form-actions button[type="button"]:hover { background: var(--border); color: var(--text); }
    .admin-login-screen { max-width: 360px; margin: 4rem auto; padding: 2rem; text-align: center; }
    .admin-login-screen input { margin: 0.5rem 0; width: 100%; padding: 0.6rem 0.9rem; font-family: inherit; font-size: 0.95rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); }
    .admin-login-screen button[type="submit"] { margin-top: 1rem; padding: 0.65rem 1.25rem; font-size: 0.95rem; font-weight: 600; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius); cursor: pointer; width: 100%; }
    .admin-login-screen .error { color: #e74c3c; font-size: 0.9rem; margin-top: 0.5rem; }
    .admin-logout-wrap { display: flex; align-items: center; gap: 0.5rem; margin-left: auto; }
    .admin-logout-btn { padding: 0.4rem 0.75rem; font-size: 0.85rem; background: var(--bg-surface); color: var(--text-muted); border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer; }
    .admin-logout-btn:hover { color: var(--text); border-color: var(--border); }
    .admin-tools-list { margin-top: 2rem; }
    .admin-tools-list h2 { font-size: 1.1rem; margin-bottom: 0.75rem; }
    .admin-tool-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 0.5rem; }
    .admin-tool-item button { padding: 0.35rem 0.65rem; font-size: 0.8rem; background: transparent; color: var(--text-muted); border: none; cursor: pointer; }
    .admin-tool-item button:hover { color: #e74c3c; }
    .admin-export { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
    .admin-export pre { background: var(--bg-surface); padding: 1rem; border-radius: var(--radius); font-size: 0.8rem; overflow-x: auto; max-height: 200px; overflow-y: auto; }
    .auth-links-row { margin-top: 1rem; font-size: 0.9rem; }
    .auth-links-row .auth-link { color: var(--accent); font-weight: 500; }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <header class="topbar">
    <div class="topbar-inner">
      <a href="index.html" class="logo">
        <span class="logo-icon">&#x2B22;</span>
        AI Knowledge Hub
      </a>
      <nav class="nav-tabs">
        <a href="index.html#tools" class="nav-tab">Tools</a>
        <a href="index.html#knowledge" class="nav-tab">Knowledge</a>
        <a href="index.html#podcasts" class="nav-tab">Podcasts</a>
        <a href="index.html#youtube" class="nav-tab">YouTube</a>
        <a href="index.html#training" class="nav-tab">Training</a>
        <a href="index.html#bleeding-edge" class="nav-tab">Bleeding Edge</a>
        <a href="niche.html" class="nav-tab">Niche AI</a>
        <a href="stack.html" class="nav-tab">My Stack</a>
        <a href="profiles.html" class="nav-tab">Profiles</a>
        <a href="admin.html" class="nav-tab active">Admin</a>
        <a href="login.html" class="nav-tab" id="nav-login">Log in</a>
        <span class="admin-logout-wrap" id="admin-logout-wrap" style="display:none">
          <span class="profile-switcher-name" id="admin-user-email"></span>
          <button type="button" class="admin-logout-btn" id="admin-logout">Log out</button>
        </span>
        <a href="about.html" class="nav-tab">About</a>
      </nav>
      <div class="topbar-actions">
        <div class="profile-switcher" id="profile-switcher"></div>
        <button type="button" class="nav-toggle" id="nav-toggle" aria-label="Toggle menu" aria-expanded="false">
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
        </button>
        <button id="theme-btn" class="icon-btn" aria-label="Toggle theme" aria-pressed="true">
          <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main id="main-content">
    <div id="admin-login-screen" class="admin-login-screen">
      <h1>Admin access</h1>
      <p class="intro">Log in to add or manage tools.</p>
      <form id="admin-login-form">
        <input type="email" id="admin-email" placeholder="Email" required autocomplete="email" aria-label="Email">
        <input type="password" id="admin-password" placeholder="Password" required autocomplete="current-password" aria-label="Password">
        <button type="submit" id="admin-login-submit">Log in</button>
      </form>
      <p class="auth-links-row"><a href="register.html" class="auth-link">Create account</a> Â· <a href="forgot-password.html" class="auth-link">Forgot password?</a></p>
      <p id="admin-login-error" class="error" style="display:none" role="alert"></p>
    </div>

    <div id="admin-content" class="admin-form" style="display:none">
      <h1>Add tool</h1>
      <p class="intro">New tools appear immediately and are stored in your browser. Use "Export for data.js" to make them permanent.</p>

      <form id="tool-form">
        <label for="tool-title">Title *</label>
        <input type="text" id="tool-title" required placeholder="e.g. ChatGPT">

        <label for="tool-description">Description *</label>
        <textarea id="tool-description" rows="2" required placeholder="Short summary of the tool"></textarea>

        <label for="tool-url">URL</label>
        <input type="url" id="tool-url" placeholder="https://...">

        <div class="admin-form-row">
          <div>
            <label for="tool-category">Category *</label>
            <select id="tool-category" required>
              <option value="tools">AI Tools</option>
              <option value="knowledge">Knowledge</option>
              <option value="podcasts">Podcasts</option>
              <option value="youtube">YouTube</option>
              <option value="training">Training</option>
              <option value="dailyWatch">Daily Watch</option>
              <option value="bleedingEdge">Bleeding Edge</option>
            </select>
          </div>
          <div>
            <label for="tool-icon">Icon (emoji)</label>
            <input type="text" id="tool-icon" placeholder="ðŸ’¬" maxlength="4">
          </div>
        </div>

        <div class="admin-form-row">
          <div>
            <label for="tool-level">Level (1â€“10)</label>
            <input type="number" id="tool-level" min="1" max="10" value="1">
          </div>
          <div>
            <label for="tool-freq">Frequency</label>
            <input type="text" id="tool-freq" placeholder="e.g. Continuous, Daily">
          </div>
        </div>

        <label for="tool-tags">Tags (comma-separated)</label>
        <input type="text" id="tool-tags" placeholder="LLM, Writing, Coding">

        <label for="tool-color1">Color gradient (hex)</label>
        <div class="admin-form-row">
          <input type="text" id="tool-color1" placeholder="#10a37f" maxlength="7">
          <input type="text" id="tool-color2" placeholder="#1a7f5a" maxlength="7">
        </div>

        <div class="admin-form-actions">
          <button type="submit">Add tool</button>
          <button type="button" id="reset-form">Reset</button>
        </div>
      </form>

      <div class="admin-tools-list" id="custom-tools-list"></div>

      <div class="admin-export">
        <h2>Export for data.js</h2>
        <p class="intro">Copy this and paste into data.js to make custom tools permanent.</p>
        <pre id="export-output"></pre>
      </div>
    </div>
  </main>

  <script src="profiles.js"></script>
  <script src="profile-switcher.js"></script>
  <script src="auth.js"></script>
  <script>
    (function () {
      const themeBtn = document.getElementById("theme-btn");
      const getTheme = () => localStorage.getItem("theme") || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      document.documentElement.setAttribute("data-theme", getTheme());
      if (themeBtn) {
        themeBtn.setAttribute("aria-pressed", getTheme() === "dark");
        themeBtn.addEventListener("click", () => {
          const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", next);
          themeBtn.setAttribute("aria-pressed", next === "dark");
          localStorage.setItem("theme", next);
        });
      }
      const navToggle = document.getElementById("nav-toggle");
      const navTabs = document.querySelector(".nav-tabs");
      if (navToggle && navTabs) {
        navToggle.addEventListener("click", () => {
          navTabs.classList.toggle("open");
          navToggle.setAttribute("aria-expanded", navTabs.classList.contains("open"));
        });
        navTabs.querySelectorAll(".nav-tab, .admin-logout-btn").forEach((el) => {
          el.addEventListener("click", () => {
            navTabs.classList.remove("open");
            navToggle.setAttribute("aria-expanded", "false");
          });
        });
      }
    })();
  </script>
  <script>
    (function () {
      const loginScreen = document.getElementById("admin-login-screen");
      const adminContent = document.getElementById("admin-content");
      const navLogin = document.getElementById("nav-login");
      const logoutWrap = document.getElementById("admin-logout-wrap");
      const userEmailEl = document.getElementById("admin-user-email");

      function unlock() {
        loginScreen.style.display = "none";
        adminContent.style.display = "block";
        if (navLogin) navLogin.style.display = "none";
        if (logoutWrap) logoutWrap.style.display = "flex";
        const session = window.Auth && window.Auth.getSession();
        if (userEmailEl && session) userEmailEl.textContent = session.email;
        loadForm();
        renderCustomList();
        renderExport();
      }

      function showLogin() {
        loginScreen.style.display = "block";
        adminContent.style.display = "none";
        if (navLogin) navLogin.style.display = "block";
        if (logoutWrap) logoutWrap.style.display = "none";
      }

      if (window.Auth && window.Auth.isLoggedIn()) {
        unlock();
      }

      document.getElementById("admin-logout").addEventListener("click", () => {
        window.Auth.logout();
        showLogin();
      });

      document.getElementById("admin-login-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const err = document.getElementById("admin-login-error");
        err.style.display = "none";

        const email = document.getElementById("admin-email").value;
        const password = document.getElementById("admin-password").value;

        const result = await window.Auth.login(email, password);
        if (result.ok) {
          unlock();
        } else {
          err.textContent = result.error || "Login failed.";
          err.style.display = "block";
        }
      });

      function getCustomTools() {
        try {
          const j = localStorage.getItem("customTools");
          return j ? JSON.parse(j) : { tools: [], knowledge: [], podcasts: [], youtube: [], training: [], dailyWatch: [], bleedingEdge: [] };
        } catch (_) {
          return { tools: [], knowledge: [], podcasts: [], youtube: [], training: [], dailyWatch: [], bleedingEdge: [] };
        }
      }

      function saveCustomTools(data) {
        localStorage.setItem("customTools", JSON.stringify(data));
      }

      function loadForm() {
        document.getElementById("tool-form").reset();
        document.getElementById("tool-level").value = "1";
      }

      document.getElementById("tool-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const tags = (document.getElementById("tool-tags").value || "")
          .split(",")
          .map((t) => t.trim())
          .filter(Boolean);
        const color1 = document.getElementById("tool-color1").value || "#10a37f";
        const color2 = document.getElementById("tool-color2").value || "#1a7f5a";

        const item = {
          title: document.getElementById("tool-title").value.trim(),
          description: document.getElementById("tool-description").value.trim(),
          url: document.getElementById("tool-url").value.trim() || "#",
          tags,
          icon: document.getElementById("tool-icon").value.trim() || "ðŸ”—",
          color: [color1, color2],
          level: parseInt(document.getElementById("tool-level").value, 10) || 1,
          freq: document.getElementById("tool-freq").value.trim() || "Continuous",
        };

        const cat = document.getElementById("tool-category").value;
        const data = getCustomTools();
        if (!data[cat]) data[cat] = [];
        data[cat].push(item);
        saveCustomTools(data);

        loadForm();
        renderCustomList();
        renderExport();
      });

      document.getElementById("reset-form").addEventListener("click", loadForm);

      function renderCustomList() {
        const data = getCustomTools();
        const names = ["tools", "knowledge", "podcasts", "youtube", "training", "dailyWatch", "bleedingEdge"];
        const labels = { tools: "AI Tools", knowledge: "Knowledge", podcasts: "Podcasts", youtube: "YouTube", training: "Training", dailyWatch: "Daily Watch", bleedingEdge: "Bleeding Edge" };
        let html = "";
        names.forEach((cat) => {
          const items = data[cat] || [];
          if (items.length === 0) return;
          html += `<h2>${labels[cat]} (${items.length})</h2>`;
          items.forEach((it, i) => {
            html += `<div class="admin-tool-item">
              <span>${escapeHtml(it.title)}</span>
              <button type="button" data-cat="${escapeAttr(cat)}" data-i="${i}">Remove</button>
            </div>`;
          });
        });
        const el = document.getElementById("custom-tools-list");
        el.innerHTML = html || '<p class="section-empty">No custom tools yet.</p>';
        el.querySelectorAll("button[data-cat]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const data = getCustomTools();
            const cat = btn.dataset.cat;
            const i = parseInt(btn.dataset.i, 10);
            data[cat].splice(i, 1);
            saveCustomTools(data);
            renderCustomList();
            renderExport();
          });
        });
      }

      function renderExport() {
        const data = getCustomTools();
        const names = ["tools", "knowledge", "podcasts", "youtube", "training", "dailyWatch", "bleedingEdge"];
        const labels = { tools: "siteData.tools", knowledge: "siteData.knowledge", podcasts: "siteData.podcasts", youtube: "siteData.youtube", training: "siteData.training", dailyWatch: "siteData.dailyWatch", bleedingEdge: "siteData.bleedingEdge" };
        const parts = [];
        names.forEach((cat) => {
          const items = data[cat] || [];
          if (items.length === 0) return;
          const arrStr = items.map((it) => {
            const tags = (it.tags || []).map((t) => `"${escapeJs(t)}"`).join(", ");
            return `    { title: "${escapeJs(it.title)}", description: "${escapeJs(it.description)}", url: "${escapeJs(it.url || "#")}", tags: [${tags}], icon: "${escapeJs(it.icon || "ðŸ”—")}", color: ["${it.color?.[0] || "#333"}","${it.color?.[1] || "#222"}"], level: ${it.level || 1}, freq: "${escapeJs(it.freq || "Continuous")}" }`;
          }).join(",\n");
          parts.push(`// Add to ${labels[cat]} in data.js:\n${arrStr}`);
        });
        const out = parts.length ? parts.join("\n\n") : "// No custom tools to export";
        document.getElementById("export-output").textContent = out;
      }

      function escapeHtml(s) {
        const d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }
      function escapeAttr(s) {
        return escapeHtml(s).replace(/"/g, "&quot;");
      }
      function escapeJs(s) {
        return String(s || "").replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\n/g, "\\n");
      }
    })();
  </script>
</body>
</html>
