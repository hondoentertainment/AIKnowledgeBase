<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Admin ‚Äî Add Tools | AI Knowledge Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='36' fill='%23c45c3e'/%3E%3Cpath d='M90 52l18 36 40 7-29 29 7 40-36-18-36 18 7-40-29-29 40-7z' fill='white'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="styles.css">
  <style>
    .admin-form { max-width: 560px; margin: 2rem auto; padding: 0 1.25rem; }
    .admin-form h1 { margin-bottom: 0.5rem; }
    .admin-form .intro { color: var(--text-muted); margin-bottom: 1.5rem; font-size: 0.95rem; }
    .admin-form label { display: block; margin-top: 1rem; font-weight: 500; font-size: 0.9rem; }
    .admin-form input, .admin-form select, .admin-form textarea { width: 100%; padding: 0.6rem 0.9rem; margin-top: 0.35rem; font-family: inherit; font-size: 0.95rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); }
    .admin-form input:focus, .admin-form select:focus, .admin-form textarea:focus { outline: 2px solid var(--accent); outline-offset: 0; }
    .admin-form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .admin-form-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
    .admin-form-actions button { padding: 0.65rem 1.25rem; font-size: 0.95rem; font-weight: 600; border-radius: var(--radius); cursor: pointer; border: none; transition: background 0.15s; }
    .admin-form-actions button[type="submit"] { background: var(--accent); color: var(--bg); }
    .admin-form-actions button[type="submit"]:hover { background: var(--accent-hover); }
    .admin-form-actions button[type="button"] { background: var(--bg-surface); color: var(--text-muted); }
    .admin-form-actions button[type="button"]:hover { background: var(--border); color: var(--text); }
    .admin-login-screen { max-width: 360px; margin: 4rem auto; padding: 2rem; text-align: center; }
    .admin-login-screen input { margin: 0.5rem 0; width: 100%; padding: 0.6rem 0.9rem; font-family: inherit; font-size: 0.95rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); }
    .admin-login-screen button[type="submit"] { margin-top: 1rem; padding: 0.65rem 1.25rem; font-size: 0.95rem; font-weight: 600; background: var(--accent); color: var(--bg); border: none; border-radius: var(--radius); cursor: pointer; width: 100%; }
    .admin-login-screen .error { color: #e74c3c; font-size: 0.9rem; margin-top: 0.5rem; }
    .admin-logout-wrap { display: flex; align-items: center; gap: 0.5rem; margin-left: auto; }
    .admin-logout-btn { padding: 0.4rem 0.75rem; font-size: 0.85rem; background: var(--bg-surface); color: var(--text-muted); border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer; }
    .admin-logout-btn:hover { color: var(--text); border-color: var(--border); }
    .admin-tools-list { margin-top: 2rem; }
    .admin-tools-list h2 { font-size: 1.1rem; margin-bottom: 0.75rem; }
    .admin-tool-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 0.5rem; gap: 0.5rem; flex-wrap: wrap; }
    .admin-tool-item a { color: var(--accent); font-weight: 500; text-decoration: none; }
    .admin-tool-item a:hover { text-decoration: underline; }
    .admin-tool-item .admin-tool-actions { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
    .admin-tool-item button { padding: 0.35rem 0.65rem; font-size: 0.8rem; background: transparent; color: var(--text-muted); border: none; cursor: pointer; }
    .admin-tool-item button:hover { color: #e74c3c; }
    .admin-tool-item button.admin-edit-btn:hover { color: var(--accent); }
    .admin-export { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
    .admin-export-actions { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; flex-wrap: wrap; }
.admin-import-label { margin: 0; cursor: pointer; }
.admin-import-label input { position: absolute; width: 0.1px; height: 0.1px; opacity: 0; }
    .admin-copy-btn { padding: 0.5rem 1rem; font-size: 0.9rem; font-weight: 600; background: var(--accent); color: var(--btn-on-accent); border: none; border-radius: var(--radius); cursor: pointer; }
    .admin-copy-btn:hover { background: var(--accent-hover); }
    .admin-copy-feedback { font-size: 0.9rem; color: var(--accent); }
    .admin-export pre { background: var(--bg-surface); padding: 1rem; border-radius: var(--radius); font-size: 0.8rem; overflow-x: auto; max-height: 200px; overflow-y: auto; }
    .admin-settings { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border); }
    .admin-settings .admin-form-row { display: flex; gap: 0.75rem; align-items: center; }
    .admin-settings #google-client-id { flex: 1; }
    .admin-field-error { display: block; font-size: 0.85rem; color: #e74c3c; margin-top: 0.25rem; }
    .auth-links-row { margin-top: 1rem; font-size: 0.9rem; }
    .auth-links-row .auth-link { color: var(--accent); font-weight: 500; }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div id="header-root"></div>
  <script src="header.js"></script>
  <script>Header.render({ activeNav: null, searchMode: "expandable" });</script>
  <script src="theme.js"></script>
  <script src="mobile-ux.js"></script>

  <main id="main-content">
    <div id="admin-login-screen" class="admin-login-screen">
      <h1>Admin access</h1>
      <p class="intro">Log in to add or manage tools.</p>
      <form id="admin-login-form">
        <input type="email" id="admin-email" placeholder="Email" required autocomplete="email" aria-label="Email">
        <input type="password" id="admin-password" placeholder="Password" required autocomplete="current-password" aria-label="Password">
        <button type="submit" id="admin-login-submit">Log in</button>
      </form>
      <p class="auth-links-row"><a href="register.html" class="auth-link">Create account</a> ¬∑ <a href="forgot-password.html" class="auth-link">Forgot password?</a></p>
      <p id="admin-login-error" class="error" style="display:none" role="alert"></p>
    </div>

    <div id="admin-content" class="admin-form" style="display:none">
      <h1 id="tool-form-heading">Add tool</h1>
      <p class="intro">New tools appear immediately and are stored in your browser. Use "Export for data.js" to make them permanent.</p>

      <form id="tool-form">
        <p id="tool-form-error" class="auth-error" role="alert" style="display:none;margin-bottom:1rem"></p>
        <label for="tool-title">Title *</label>
        <input type="text" id="tool-title" required placeholder="e.g. ChatGPT">

        <label for="tool-description">Description *</label>
        <textarea id="tool-description" rows="2" required placeholder="Short summary of the tool"></textarea>

        <label for="tool-url">URL</label>
        <input type="url" id="tool-url" placeholder="https://..." aria-describedby="tool-url-error" aria-invalid="false">
        <span id="tool-url-error" class="admin-field-error" role="alert"></span>

        <div class="admin-form-row">
          <div>
            <label for="tool-category">Category *</label>
            <select id="tool-category" required>
              <option value="tools">AI Tools</option>
              <option value="knowledge">Knowledge</option>
              <option value="podcasts">Podcasts</option>
              <option value="youtube">YouTube</option>
              <option value="training">Training</option>
              <option value="dailyWatch">Daily Watch</option>
              <option value="bleedingEdge">Bleeding Edge</option>
            </select>
          </div>
          <div>
            <label for="tool-icon">Icon (emoji)</label>
            <input type="text" id="tool-icon" placeholder="üí¨" maxlength="4">
          </div>
        </div>

        <div class="admin-form-row">
          <div>
            <label for="tool-level">Level (1‚Äì10)</label>
            <input type="number" id="tool-level" min="1" max="10" value="1">
          </div>
          <div>
            <label for="tool-freq">Frequency</label>
            <input type="text" id="tool-freq" placeholder="e.g. Continuous, Daily">
          </div>
        </div>

        <label for="tool-tags">Tags (comma-separated)</label>
        <input type="text" id="tool-tags" placeholder="LLM, Writing, Coding">

        <label for="tool-color1">Color gradient (hex)</label>
        <div class="admin-form-row">
          <div>
            <input type="text" id="tool-color1" placeholder="#10a37f" maxlength="7" aria-describedby="tool-color-error" aria-invalid="false">
          </div>
          <div>
            <input type="text" id="tool-color2" placeholder="#1a7f5a" maxlength="7" aria-describedby="tool-color-error" aria-invalid="false">
          </div>
        </div>
        <span id="tool-color-error" class="admin-field-error" role="alert"></span>

        <div class="admin-form-actions">
          <button type="submit" id="tool-form-submit">Add tool</button>
          <button type="button" id="reset-form">Reset</button>
          <button type="button" id="cancel-edit" style="display:none">Cancel edit</button>
        </div>
      </form>

      <div class="admin-tools-list" id="custom-tools-list"></div>

      <div class="admin-settings">
        <h2>Settings</h2>
        <label for="google-client-id">Google OAuth Client ID</label>
        <p class="intro">Enable "Sign in with Google" on login and register pages. <a href="auth-setup.html">Setup guide</a> ¬∑ <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener">Create credentials</a> in Google Cloud Console, then paste the Client ID here.</p>
        <div class="admin-form-row">
          <input type="text" id="google-client-id" placeholder="123456789-abc.apps.googleusercontent.com" aria-label="Google OAuth Client ID">
          <button type="button" id="save-google-client-id" class="admin-copy-btn">Save</button>
        </div>
        <span id="google-client-id-feedback" class="admin-copy-feedback" aria-live="polite"></span>
      </div>

      <div class="admin-export">
        <h2>Export for data.js</h2>
        <p class="intro">Copy this and paste into data.js to make custom tools permanent.</p>
        <div class="admin-export-actions">
          <button type="button" id="admin-copy-export" class="admin-copy-btn">Copy to clipboard</button>
          <button type="button" id="admin-download-json" class="admin-copy-btn">Download JSON</button>
          <label class="admin-import-label">
            <input type="file" id="admin-import-json" accept=".json,application/json" class="sr-only">
            <span class="admin-copy-btn">Import JSON</span>
          </label>
          <span id="admin-copy-feedback" class="admin-copy-feedback" aria-live="polite"></span>
        </div>
        <pre id="export-output"></pre>
      </div>
    </div>
  </main>

  <!-- Mobile bottom navigation -->
  <nav class="bottom-nav" aria-label="Mobile navigation">
    <div class="bottom-nav-inner">
      <a href="index.html" class="bottom-nav-item">
        <span class="bottom-nav-icon" aria-hidden="true">üè†</span>
        <span class="bottom-nav-label">Home</span>
      </a>
      <a href="tools.html" class="bottom-nav-item">
        <span class="bottom-nav-icon" aria-hidden="true">üîß</span>
        <span class="bottom-nav-label">Tools</span>
      </a>
      <button type="button" class="bottom-nav-item" id="bottom-search-btn" aria-label="Search">
        <span class="bottom-nav-icon" aria-hidden="true">üîç</span>
        <span class="bottom-nav-label">Search</span>
      </button>
      <a href="stack.html" class="bottom-nav-item">
        <span class="bottom-nav-icon" aria-hidden="true">üìö</span>
        <span class="bottom-nav-label">My Stack</span>
      </a>
      <button type="button" class="bottom-nav-item" id="bottom-more-btn" aria-label="More pages">
        <span class="bottom-nav-icon" aria-hidden="true">‚ò∞</span>
        <span class="bottom-nav-label">More</span>
      </button>
    </div>
  </nav>

  <div class="nav-backdrop" id="nav-backdrop" aria-hidden="true"></div>

  <script src="profiles.js"></script>
  <script src="profile-switcher.js"></script>
  <script src="auth.js"></script>
  <script src="bottom-nav.js"></script>
  <script>
    (function () {
      if (window.Auth?.isLoggedIn() && !window.Auth?.isAdmin()) {
        window.location.href = "profiles.html";
      }
    })();
  </script>
  <script>
    (function () {
      const navToggle = document.getElementById("nav-toggle");
      const navTabs = document.querySelector(".nav-tabs");
      const navBackdrop = document.getElementById("nav-backdrop");
      const bottomMoreBtn = document.getElementById("bottom-more-btn");
      let scrollPos = 0;

      function closeNav() {
        if (!navTabs || !navToggle) return;
        navTabs.classList.remove("open");
        navToggle.setAttribute("aria-expanded", "false");
        if (navBackdrop) { navBackdrop.classList.remove("visible"); setTimeout(() => { navBackdrop.style.display = ""; }, 300); }
        document.body.classList.remove("nav-open");
        document.body.style.top = "";
        window.scrollTo(0, scrollPos);
      }

      function openNav() {
        if (!navTabs || !navToggle) return;
        scrollPos = window.scrollY;
        document.body.style.top = `-${scrollPos}px`;
        document.body.classList.add("nav-open");
        navTabs.classList.add("open");
        navToggle.setAttribute("aria-expanded", "true");
        if (navBackdrop) { navBackdrop.style.display = "block"; requestAnimationFrame(() => navBackdrop.classList.add("visible")); }
      }

      if (navToggle && navTabs) {
        navToggle.addEventListener("click", () => {
          navTabs.classList.contains("open") ? closeNav() : openNav();
        });
        navTabs.querySelectorAll(".nav-tab, .admin-logout-btn").forEach((el) => {
          el.addEventListener("click", closeNav);
        });
        if (navBackdrop) navBackdrop.addEventListener("click", closeNav);
        document.addEventListener("keydown", (e) => { if (e.key === "Escape" && navTabs.classList.contains("open")) { closeNav(); navToggle.focus(); } });
      }
      if (bottomMoreBtn) {
        bottomMoreBtn.addEventListener("click", () => {
          navTabs && !navTabs.classList.contains("open") ? openNav() : closeNav();
        });
      }
    })();
  </script>
  <script>
    (function () {
      const loginScreen = document.getElementById("admin-login-screen");
      const adminContent = document.getElementById("admin-content");
      const navLogin = document.getElementById("nav-login");
      const logoutWrap = document.getElementById("auth-user-wrap");
      const userEmailEl = document.getElementById("auth-user-email");

      function unlock() {
        loginScreen.style.display = "none";
        adminContent.style.display = "block";
        if (navLogin) navLogin.style.display = "none";
        if (logoutWrap) logoutWrap.style.display = "inline-flex";
        const session = window.Auth && window.Auth.getSession();
        if (userEmailEl && session) userEmailEl.textContent = session.email;
        loadForm();
        renderCustomList();
        renderExport();
        loadGoogleClientId();
        const firstInput = adminContent.querySelector("#tool-title");
        if (firstInput) firstInput.focus();
      }

      function loadGoogleClientId() {
        const el = document.getElementById("google-client-id");
        if (el && window.Auth) el.value = window.Auth.getGoogleClientId() || "";
      }

      document.getElementById("save-google-client-id")?.addEventListener("click", function () {
        const el = document.getElementById("google-client-id");
        const feedback = document.getElementById("google-client-id-feedback");
        if (!el || !window.Auth) return;
        const value = el.value.trim();
        window.Auth.setGoogleClientId(value);
        if (feedback) {
          feedback.textContent = value ? "Saved. Google sign-in is now available." : "Cleared.";
          setTimeout(function () { feedback.textContent = ""; }, 3000);
        }
      });

      function showLogin() {
        loginScreen.style.display = "block";
        adminContent.style.display = "none";
        if (navLogin) navLogin.style.display = "block";
        if (logoutWrap) logoutWrap.style.display = "none";
        const emailInput = document.getElementById("admin-email");
        if (emailInput) emailInput.focus();
      }

      if (window.Auth && window.Auth.isLoggedIn()) {
        unlock();
      }

      document.getElementById("nav-logout").addEventListener("click", () => {
        window.Auth.logout();
        showLogin();
      });

      document.getElementById("admin-login-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const err = document.getElementById("admin-login-error");
        err.style.display = "none";

        const email = document.getElementById("admin-email").value;
        const password = document.getElementById("admin-password").value;

        const result = await window.Auth.login(email, password);
        if (result.ok) {
          unlock();
        } else {
          err.textContent = result.error || "Login failed.";
          err.style.display = "block";
        }
      });

      function getCustomTools() {
        try {
          const j = localStorage.getItem("customTools");
          return j ? JSON.parse(j) : { tools: [], knowledge: [], podcasts: [], youtube: [], training: [], dailyWatch: [], bleedingEdge: [] };
        } catch (_) {
          return { tools: [], knowledge: [], podcasts: [], youtube: [], training: [], dailyWatch: [], bleedingEdge: [] };
        }
      }

      function saveCustomTools(data) {
        localStorage.setItem("customTools", JSON.stringify(data));
      }

      let formDirty = false;

      function loadForm() {
        clearEdit();
        document.getElementById("tool-form").reset();
        document.getElementById("tool-level").value = "1";
        formDirty = false;
        clearFieldErrors();
      }

      function clearFieldErrors() {
        const urlErr = document.getElementById("tool-url-error");
        const colorErr = document.getElementById("tool-color-error");
        const urlInput = document.getElementById("tool-url");
        const color1 = document.getElementById("tool-color1");
        const color2 = document.getElementById("tool-color2");
        if (urlErr) urlErr.textContent = "";
        if (colorErr) colorErr.textContent = "";
        if (urlInput) urlInput.setAttribute("aria-invalid", "false");
        if (color1) color1.setAttribute("aria-invalid", "false");
        if (color2) color2.setAttribute("aria-invalid", "false");
      }

      function showUrlError(msg) {
        const el = document.getElementById("tool-url-error");
        const input = document.getElementById("tool-url");
        if (el) el.textContent = msg || "";
        if (input) input.setAttribute("aria-invalid", msg ? "true" : "false");
      }

      function showColorError(msg) {
        const el = document.getElementById("tool-color-error");
        const c1 = document.getElementById("tool-color1");
        const c2 = document.getElementById("tool-color2");
        if (el) el.textContent = msg || "";
        const invalid = !!msg;
        if (c1) c1.setAttribute("aria-invalid", invalid ? "true" : "false");
        if (c2) c2.setAttribute("aria-invalid", invalid ? "true" : "false");
      }

      function isValidHex(s) { return /^#[0-9a-fA-F]{6}$/.test(s || ""); }
      function isValidUrl(s) { if (!s || s === "#") return true; try { new URL(s); return true; } catch (_) { return false; } }

      var toolForm = document.getElementById("tool-form");
      if (toolForm) {
        toolForm.querySelectorAll("input, select, textarea").forEach(function (el) {
          el.addEventListener("input", function () { formDirty = true; });
          el.addEventListener("change", function () { formDirty = true; });
        });
      }

      document.getElementById("tool-url")?.addEventListener("blur", function () {
        var v = this.value.trim();
        if (!v || v === "#") { showUrlError(""); return; }
        showUrlError(isValidUrl(v) ? "" : "Enter a valid URL (e.g. https://example.com)");
      });

      function validateColorsOnBlur() {
        var c1 = (document.getElementById("tool-color1")?.value || "").trim() || "#10a37f";
        var c2 = (document.getElementById("tool-color2")?.value || "").trim() || "#1a7f5a";
        if (isValidHex(c1) && isValidHex(c2)) showColorError("");
        else showColorError("Use hex format (e.g. #10a37f)");
      }
      document.getElementById("tool-color1")?.addEventListener("blur", validateColorsOnBlur);
      document.getElementById("tool-color2")?.addEventListener("blur", validateColorsOnBlur);
      document.getElementById("tool-color1")?.addEventListener("input", validateColorsOnBlur);
      document.getElementById("tool-color2")?.addEventListener("input", validateColorsOnBlur);

      window.addEventListener("beforeunload", function (e) {
        if (formDirty) e.preventDefault();
      });

      document.getElementById("tool-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const urlVal = document.getElementById("tool-url").value.trim();
        const color1 = document.getElementById("tool-color1").value.trim() || "#10a37f";
        const color2 = document.getElementById("tool-color2").value.trim() || "#1a7f5a";
        const errEl = document.getElementById("tool-form-error");
        if (errEl) errEl.style.display = "none";
        showUrlError(urlVal && !isValidUrl(urlVal) ? "Enter a valid URL." : "");
        if (!isValidHex(color1) || !isValidHex(color2)) showColorError("Use hex format (e.g. #10a37f)");
        else showColorError("");
        if ((urlVal && !isValidUrl(urlVal)) || !isValidHex(color1) || !isValidHex(color2)) {
          if (errEl) { errEl.textContent = "Please fix the errors above."; errEl.style.display = "block"; }
          return;
        }

        const tags = (document.getElementById("tool-tags").value || "")
          .split(",")
          .map((t) => t.trim())
          .filter(Boolean);

        const item = {
          title: document.getElementById("tool-title").value.trim(),
          description: document.getElementById("tool-description").value.trim(),
          url: document.getElementById("tool-url").value.trim() || "#",
          tags,
          icon: document.getElementById("tool-icon").value.trim() || "üîó",
          color: [color1, color2],
          level: parseInt(document.getElementById("tool-level").value, 10) || 1,
          freq: document.getElementById("tool-freq").value.trim() || "Continuous",
        };

        const cat = document.getElementById("tool-category").value;
        const data = getCustomTools();
        if (!data[cat]) data[cat] = [];

        if (editingCat !== null && editingIndex !== null) {
          if (editingCat === cat) {
            data[cat][editingIndex] = item;
          } else {
            data[editingCat].splice(editingIndex, 1);
            if (!data[cat]) data[cat] = [];
            data[cat].push(item);
          }
          clearEdit();
        } else {
          data[cat].push(item);
        }
        saveCustomTools(data);
        formDirty = false;
        clearFieldErrors();

        loadForm();
        renderCustomList();
        renderExport();
      });

      document.getElementById("reset-form").addEventListener("click", function () { loadForm(); });
      document.getElementById("cancel-edit").addEventListener("click", function () {
        clearEdit();
        formDirty = false;
      });

      function renderCustomList() {
        const data = getCustomTools();
        const names = ["tools", "knowledge", "podcasts", "youtube", "training", "dailyWatch", "bleedingEdge"];
        const labels = { tools: "AI Tools", knowledge: "Knowledge", podcasts: "Podcasts", youtube: "YouTube", training: "Training", dailyWatch: "Daily Watch", bleedingEdge: "Bleeding Edge" };
        let html = "";
        names.forEach((cat) => {
          const items = data[cat] || [];
          if (items.length === 0) return;
          html += `<h2>${labels[cat]} (${items.length})</h2>`;
          items.forEach((it, i) => {
            const hasUrl = it.url && it.url !== "#";
            const titlePart = hasUrl
              ? `<a href="${escapeAttr(it.url)}" target="_blank" rel="noopener">${escapeHtml(it.title)}</a>`
              : escapeHtml(it.title);
            const visitLink = hasUrl
              ? `<a href="${escapeAttr(it.url)}" target="_blank" rel="noopener">Visit</a>`
              : "";
            html += `<div class="admin-tool-item">
              <span>${titlePart}</span>
              <div class="admin-tool-actions">
                ${visitLink}
                <button type="button" class="admin-edit-btn" data-action="edit" data-cat="${escapeAttr(cat)}" data-i="${i}">Edit</button>
                <button type="button" data-action="remove" data-cat="${escapeAttr(cat)}" data-i="${i}">Remove</button>
              </div>
            </div>`;
          });
        });
        const el = document.getElementById("custom-tools-list");
        el.innerHTML = html || '<p class="section-empty">No custom tools yet.</p>';
        el.querySelectorAll("button[data-action='edit']").forEach((btn) => {
          btn.addEventListener("click", () => {
            startEdit(btn.dataset.cat, parseInt(btn.dataset.i, 10));
          });
        });
        el.querySelectorAll("button[data-action='remove']").forEach((btn) => {
          btn.addEventListener("click", () => {
            const item = (getCustomTools()[btn.dataset.cat] || [])[parseInt(btn.dataset.i, 10)];
            const title = item?.title || "this tool";
            if (!confirm("Remove \"" + title + "\"? This cannot be undone.")) return;
            const data = getCustomTools();
            const cat = btn.dataset.cat;
            const i = parseInt(btn.dataset.i, 10);
            if (editingCat === cat && editingIndex === i) clearEdit();
            data[cat].splice(i, 1);
            saveCustomTools(data);
            renderCustomList();
            renderExport();
          });
        });
      }

      let editingCat = null;
      let editingIndex = null;

      function startEdit(cat, i) {
        const data = getCustomTools();
        const item = (data[cat] || [])[i];
        if (!item) return;
        editingCat = cat;
        editingIndex = i;
        document.getElementById("tool-title").value = item.title || "";
        document.getElementById("tool-description").value = item.description || "";
        document.getElementById("tool-url").value = (item.url && item.url !== "#") ? item.url : "";
        document.getElementById("tool-category").value = cat;
        document.getElementById("tool-icon").value = item.icon || "üîó";
        document.getElementById("tool-level").value = String(item.level || 1);
        document.getElementById("tool-freq").value = item.freq || "Continuous";
        document.getElementById("tool-tags").value = (item.tags || []).join(", ");
        document.getElementById("tool-color1").value = (item.color && item.color[0]) || "#10a37f";
        document.getElementById("tool-color2").value = (item.color && item.color[1]) || "#1a7f5a";
        document.getElementById("tool-form-heading").textContent = "Edit tool";
        document.getElementById("tool-form-submit").textContent = "Save changes";
        document.getElementById("cancel-edit").style.display = "inline-block";
        document.getElementById("tool-title").focus();
      }

      function clearEdit() {
        editingCat = null;
        editingIndex = null;
        document.getElementById("tool-form-heading").textContent = "Add tool";
        document.getElementById("tool-form-submit").textContent = "Add tool";
        document.getElementById("cancel-edit").style.display = "none";
        loadForm();
      }

      function renderExport() {
        const data = getCustomTools();
        const names = ["tools", "knowledge", "podcasts", "youtube", "training", "dailyWatch", "bleedingEdge"];
        const labels = { tools: "siteData.tools", knowledge: "siteData.knowledge", podcasts: "siteData.podcasts", youtube: "siteData.youtube", training: "siteData.training", dailyWatch: "siteData.dailyWatch", bleedingEdge: "siteData.bleedingEdge" };
        const parts = [];
        names.forEach((cat) => {
          const items = data[cat] || [];
          if (items.length === 0) return;
          const arrStr = items.map((it) => {
            const tags = (it.tags || []).map((t) => `"${escapeJs(t)}"`).join(", ");
            return `    { title: "${escapeJs(it.title)}", description: "${escapeJs(it.description)}", url: "${escapeJs(it.url || "#")}", tags: [${tags}], icon: "${escapeJs(it.icon || "üîó")}", color: ["${it.color?.[0] || "#333"}","${it.color?.[1] || "#222"}"], level: ${it.level || 1}, freq: "${escapeJs(it.freq || "Continuous")}" }`;
          }).join(",\n");
          parts.push(`// Add to ${labels[cat]} in data.js:\n${arrStr}`);
        });
        const out = parts.length ? parts.join("\n\n") : "// No custom tools to export";
        document.getElementById("export-output").textContent = out;
      }

      document.getElementById("admin-copy-export")?.addEventListener("click", () => {
        const pre = document.getElementById("export-output");
        const feedback = document.getElementById("admin-copy-feedback");
        const text = pre?.textContent || "";
        navigator.clipboard.writeText(text).then(() => {
          if (feedback) {
            feedback.textContent = "Copied!";
            setTimeout(() => { feedback.textContent = ""; }, 2000);
          }
        }).catch(() => {
          if (feedback) feedback.textContent = "Copy failed.";
        });
      });

      document.getElementById("admin-download-json")?.addEventListener("click", () => {
        const data = getCustomTools();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "ai-knowledge-hub-custom-tools-" + new Date().toISOString().slice(0, 10) + ".json";
        a.click();
        URL.revokeObjectURL(a.href);
        const feedback = document.getElementById("admin-copy-feedback");
        if (feedback) {
          feedback.textContent = "Downloaded.";
          setTimeout(() => { feedback.textContent = ""; }, 2000);
        }
      });

      document.getElementById("admin-import-json")?.addEventListener("change", function (e) {
        const file = e.target?.files?.[0];
        if (!file) return;
        const feedback = document.getElementById("admin-copy-feedback");
        const r = new FileReader();
        r.onerror = () => { if (feedback) feedback.textContent = "Could not read file."; };
        r.onload = () => {
          try {
            const raw = r.result;
            if (typeof raw !== "string" || !raw.trim()) throw new Error("File is empty");
            const imported = JSON.parse(raw);
            if (!imported || typeof imported !== "object") throw new Error("Invalid JSON");
            const names = ["tools", "knowledge", "podcasts", "youtube", "training", "dailyWatch", "bleedingEdge"];
            const existing = getCustomTools();
            names.forEach((cat) => {
              const arr = imported[cat];
              if (Array.isArray(arr) && arr.length > 0) {
                existing[cat] = [...(existing[cat] || []), ...arr];
              }
            });
            saveCustomTools(existing);
            renderCustomList();
            renderExport();
            if (feedback) {
              feedback.textContent = "Imported successfully.";
              setTimeout(() => { feedback.textContent = ""; }, 3000);
            }
          } catch (err) {
            if (feedback) feedback.textContent = "Import failed: " + (err.message || "Invalid file");
          }
        };
        r.readAsText(file);
        e.target.value = "";
      });

      function escapeHtml(s) {
        const d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }
      function escapeAttr(s) {
        return escapeHtml(s).replace(/"/g, "&quot;");
      }
      function escapeJs(s) {
        return String(s || "").replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\n/g, "\\n");
      }
    })();
  </script>
</body>
</html>
